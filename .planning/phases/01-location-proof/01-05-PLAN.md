---
phase: 01-location-proof
plan: 05
type: execute
wave: 2
depends_on: ["01-01", "01-02", "01-03", "01-04"]
files_modified: [server/index.js, client-next/src/lib/api.ts]
autonomous: false
domain: nodejs-backend
---

<objective>
Integration testing and verification of all location-proof discovery endpoints.

Purpose: Verify all endpoints work correctly with multi-location discovery and source tracking.
Output: Tested and verified API endpoints with documentation of behavior.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
@~/.config/opencode/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@server/index.js
@client-next/src/lib/api.ts

## Testing Scope

**Endpoints to Verify:**
1. `GET /api/skills` - New endpoint (Plan 01)
2. `GET /api/plugins` - New endpoint (Plan 02)
3. `GET /api/agents` - Updated endpoint (Plan 03)
4. `GET /api/models` - New endpoint (Plan 04)
5. `GET /api/mcp` - Existing (should still work)
6. `GET /api/commands` - Existing (should still work)

**Test Scenarios:**
1. Empty directories (graceful handling)
2. Single source (correct source field)
3. Multiple sources (deduplication)
4. Priority ordering (correct precedence)
5. Error handling (invalid files, permissions)

## Frontend API Client

Check client-next/src/lib/api.ts for API methods:
- May need to add methods for new endpoints (/api/skills, /api/plugins, /api/models)
- Existing methods for /api/mcp, /api/commands, /api/agents should work
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update frontend API client for new endpoints</name>
  <files>client-next/src/lib/api.ts</files>
  <action>
Check client-next/src/lib/api.ts and add methods for new endpoints if missing.

Look for existing patterns like:
```typescript
export const api = {
  getMCPs: () => axios.get('/api/mcp'),
  getCommands: () => axios.get('/api/commands'),
  getAgents: () => axios.get('/api/agents'),
  // ... etc
}
```

Add if missing:
```typescript
getSkills: () => axios.get('/api/skills'),
getPlugins: () => axios.get('/api/plugins'),
getModels: () => axios.get('/api/models'),
```

Ensure TypeScript types are consistent with response format.
  </action>
  <verify>grep -n "getSkills\|getPlugins\|getModels" client-next/src/lib/api.ts</verify>
  <done>API client has methods for all new endpoints</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Integration Testing</name>
  <what-built>
All location-proof discovery endpoints:
- /api/skills - Multi-location skill discovery
- /api/plugins - Multi-location plugin discovery  
- /api/agents - Updated multi-location agent discovery
- /api/models - Multi-location model/provider discovery
- /api/mcp - Existing MCP discovery
- /api/commands - Existing command discovery
  </what-built>
  <how-to-verify>
1. Start server: `cd server && node index.js`
2. Verify server starts without errors
3. Test each endpoint:
   ```bash
   curl -s http://localhost:1920/api/skills | jq '.[] | {name, source}'
   curl -s http://localhost:1920/api/plugins | jq '.[] | {name, source}'
   curl -s http://localhost:1920/api/agents | jq '.agents[] | {name, source}'
   curl -s http://localhost:1920/api/models | jq '.providers[] | {name, source}'
   curl -s http://localhost:1920/api/mcp | jq '.[] | {name, source}'
   curl -s http://localhost:1920/api/commands | jq '.[] | {name, source}'
   ```
4. Create test files and verify discovery:
   ```bash
   # Skills
   mkdir -p ~/.config/opencode/skill/test-skill
   echo "---\nname: test-skill\n---\nContent" > ~/.config/opencode/skill/test-skill/SKILL.md
   
   # Plugins
   echo "export default {}" > ~/.config/opencode/plugin/test-plugin.js
   
   # Agents
   echo "---\nname: test-agent\n---\nPrompt" > ~/.config/opencode/agents/test-agent.md
   
   # Commands
   echo "Command content" > ~/.config/opencode/command/test-command.md
   
   # MCPs
   echo '{"command": "test"}' > ~/.config/opencode/mcp/test-mcp.json
   ```
5. Re-test endpoints and verify new items appear with correct source
6. Verify deduplication works (create duplicate names in different sources)
  </how-to-verify>
  <resume-signal>Type "verified" when all endpoints respond correctly with source tracking</resume-signal>
</task>

</tasks>

<verification>
Before declaring complete:
- [ ] All 6 endpoints respond without errors
- [ ] Each item has source field indicating origin
- [ ] Deduplication works correctly
- [ ] Priority ordering correct (directory > JSON)
- [ ] Frontend API client updated
- [ ] Server logs show no warnings/errors
</verification>

<success_criteria>
- All endpoints tested and working
- Source tracking verified for all entity types
- Deduplication tested and working
- Frontend API client has all methods
- Integration test passed
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/01-location-proof/01-05-SUMMARY.md`
</output>

## Summary of Phase 01

**Wave 1 (Parallel):**
- Plan 01: Skills API with multi-location discovery
- Plan 02: Plugins API with multi-location discovery
- Plan 03: Agents API updated for multi-location aggregation
- Plan 04: Models API with multi-location provider aggregation

**Wave 2 (Sequential):**
- Plan 05: Integration testing and verification

**Key Features Implemented:**
- Source tracking for all entity types (skills, plugins, agents, models, MCPs, commands)
- Multi-location discovery from all search roots
- Deduplication with priority ordering
- Consistent API patterns across all endpoints
